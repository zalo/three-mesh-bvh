import{V as v,L as J,j as K,l as k,C as Q,W as _,k as ee,S as te,F as ae,D as ie,H as ne,P as re,M as z,m as se,c as I,n as oe,N as le,Z as O,f as de,B as pe,o as ce,p as me,q as fe,d as ue,E as we,r as he,I as Z,s as ye,t as A,G as Me,a as ge,e as xe}from"./ExtendedTriangle-Chm2bbkR.js";import{G as Se}from"./GLTFLoader-Dl6abS6P.js";import{M as be}from"./meshopt_decoder.module-Cf1-17OU.js";import{O as Pe}from"./OrbitControls-lzJCl7xY.js";import{S as De}from"./stats.min-GTpOrGrX.js";import{g as Fe}from"./lil-gui.module.min-Bc0DeA9g.js";import{M as Be,a as We}from"./MeshBVH-CPVAl5W3.js";import{M as Ce}from"./MeshBVHHelper-jLfel8l5.js";import"./BufferGeometryUtils-Cscy-pCt.js";import"./_commonjsHelpers-Cpj98o6Y.js";const a={useBVH:!0,helperDisplay:!1,helperDepth:10,wireframeDisplay:!1,displayModel:!0,animate:!0,animation:"SPIN",invert:!1};let l,h,M,w,q,j,X,L,m,f,g,W,r,C,d,N=!1,Y=null,S=0;const o=new v,V=new v,G=new v,B=new v,c=new J,R=new K,b=new k;Le();U();function Le(){Y=document.getElementById("output");const P=new Q(2503224).multiplyScalar(.1);l=new _({antialias:!0,stencil:!0}),l.setPixelRatio(window.devicePixelRatio),l.setSize(window.innerWidth,window.innerHeight),l.setClearColor(P,1),l.shadowMap.enabled=!0,l.shadowMap.type=ee,l.localClippingEnabled=!0,document.body.appendChild(l.domElement),M=new te,M.fog=new ae(P,20,70);const u=new ie(16777215,2.5);u.position.set(1,1.5,2).multiplyScalar(50),M.add(u),M.add(new ne(16777215,2241348,1.5)),h=new re(75,window.innerWidth/window.innerHeight,.01,50),h.position.set(.4,.4,.4),h.far=100,h.updateProjectionMatrix(),j=new Pe(h,l.domElement),X=new xe,C=[new k],r=new z(new se,new I({side:oe,stencilWrite:!0,stencilFunc:le,stencilFail:O,stencilZFail:O,stencilZPass:O})),r.scale.setScalar(1.5),r.material.color.set(8445674),r.renderOrder=2,M.add(r);const i=new de,p=new pe(new Float32Array(3e5),3,!1);p.setUsage(ce),i.setAttribute("position",p),d=new me(i,new fe),d.material.color.set(44225),d.frustumCulled=!1,d.renderOrder=3;const D=new Se;D.setMeshoptDecoder(be),D.load("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/internal-combustion-engine/model.gltf",s=>{const t=s.scene.children[0],H=t.geometry;t.material=new I,t.position.set(0,0,0),t.quaternion.identity();const E=t.clone();E.material=new ue({depthFunc:we}),E.renderOrder=1,d.scale.copy(t.scale),d.position.set(0,0,0),d.quaternion.identity(),t.updateMatrixWorld(!0);const $=new Set,y=new Map;g=t,g.updateMatrixWorld(!0),g.traverse(n=>{if(n.isMesh){if(y.has(n.material)){n.material=y.get(n.material);return}$.add(n.material);const e=n.material.clone();e.color.set(16777215),e.roughness=1,e.metalness=0,e.side=he,e.stencilWrite=!0,e.stencilFail=Z,e.stencilZFail=Z,e.stencilZPass=Z,e.clippingPlanes=C,y.set(n.material,e),n.material=e}}),y.clear(),W=g.clone(),W.traverse(n=>{if(n.isMesh){if(y.has(n.material)){n.material=y.get(n.material);return}const e=n.material.clone();e.color.set(16777215),e.roughness=1,e.metalness=0,e.colorWrite=!1,e.depthWrite=!1,e.side=ye,e.stencilWrite=!0,e.stencilFail=A,e.stencilZFail=A,e.stencilZPass=A,e.clippingPlanes=C,y.set(n.material,e),n.material=e}}),L=new Be(H,{maxLeafTris:3}),H.boundsTree=L,m=new z(H,new I({wireframe:!0,transparent:!0,opacity:.01,depthWrite:!1})),m.renderOrder=2,m.position.copy(t.position),m.rotation.copy(t.rotation),m.scale.copy(t.scale),f=new Ce(m,parseInt(a.helperDepth)),f.depth=parseInt(a.helperDepth),f.update();const F=new Me;F.add(g,W,E,m,f,d);const T=new ge;T.setFromObject(g),T.getCenter(F.position).multiplyScalar(-1),F.updateMatrixWorld(!0),M.add(F)}),w=new Fe,w.add(a,"invert"),w.add(a,"animate"),w.add(a,"animation",["SPIN","OSCILLATE"]).onChange(()=>{S=0}),w.add(a,"displayModel"),w.add(a,"useBVH");const x=w.addFolder("helper");x.add(a,"wireframeDisplay"),x.add(a,"helperDisplay"),x.add(a,"helperDepth",1,20,1).onChange(s=>{f&&(f.depth=parseInt(s),f.update())}),x.open(),w.open(),q=new De,document.body.appendChild(q.domElement),window.addEventListener("resize",function(){h.aspect=window.innerWidth/window.innerHeight,h.updateProjectionMatrix(),l.setSize(window.innerWidth,window.innerHeight),l.setPixelRatio(window.devicePixelRatio)},!1)}function U(){f&&(f.visible=a.helperDisplay,m.visible=a.wireframeDisplay,g.visible=a.displayModel,W.visible=a.displayModel),d.material.color.set(a.displayModel?44225:5099745).convertSRGBToLinear();const P=Math.min(X.getDelta(),.03);a.animate&&(S+=P,a.animation==="SPIN"?(r.rotation.x=.25*S,r.rotation.y=.25*S,r.rotation.z=.25*S,r.position.set(0,0,0)):(r.position.set(Math.sin(.25*S)*.325,0,0),r.rotation.set(0,Math.PI/2,0)),r.updateMatrixWorld());const u=C[0];if(u.normal.set(0,0,a.invert?1:-1),u.constant=0,u.applyMatrix4(r.matrixWorld),L&&(a.animate||!N)){N=!0,R.copy(m.matrixWorld).invert(),b.copy(u).applyMatrix4(R);let i=0;const p=d.geometry.attributes.position,D=window.performance.now();L.shapecast({intersectsBounds:s=>a.useBVH?b.intersectsBox(s):We,intersectsTriangle:s=>{let t=0;c.start.copy(s.a),c.end.copy(s.b),b.intersectLine(c,o)&&(p.setXYZ(i,o.x,o.y,o.z),i++,t++),c.start.copy(s.b),c.end.copy(s.c),b.intersectLine(c,o)&&(p.setXYZ(i,o.x,o.y,o.z),t++,i++),c.start.copy(s.c),c.end.copy(s.a),b.intersectLine(c,o)&&(p.setXYZ(i,o.x,o.y,o.z),t++,i++),t===3&&(V.fromBufferAttribute(p,i-3),G.fromBufferAttribute(p,i-2),B.fromBufferAttribute(p,i-1),B.equals(V)||B.equals(G)?(t--,i--):V.equals(G)&&(p.setXYZ(i-2,B),t--,i--)),t!==2&&(i-=t)}}),d.geometry.setDrawRange(0,i),d.position.copy(u.normal).multiplyScalar(-1e-5),p.needsUpdate=!0;const x=window.performance.now()-D;Y.innerText=`${parseFloat(x.toFixed(3))}ms`}q.update(),requestAnimationFrame(U),j.update(),l.render(M,h)}
